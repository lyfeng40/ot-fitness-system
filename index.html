<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OT Supervisor Management Console</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/recharts@2.12.7/umd/Recharts.js"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        @media print {
            body { visibility: hidden; }
            #report-content { visibility: visible; position: absolute; left: 0; top: 0; width: 100%; }
            .break-before-page { page-break-before: always; margin-top: 1cm; }
        }
    </style>
</head>
<body class="min-h-screen bg-slate-50 p-4 md:p-8">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo } = React;
        const { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, RadarChart, PolarGrid, PolarAngleAxis, PolarRadiusAxis, Radar, PieChart } = Recharts;
        const { User, Activity, Clipboard, Download, PlusCircle, Database, Calendar, Info, Heart, Coffee, Users } = lucide;

        const calculateAge = (birthday) => {
            if (!birthday) return 0;
            const birthDate = new Date(birthday);
            const today = new Date();
            let age = today.getFullYear() - birthDate.getFullYear();
            const m = today.getMonth() - birthDate.getMonth();
            if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) age--;
            return age;
        };

        const getSitupsLevel = (count, gender, age) => {
            if (gender === '男') {
                if (count >= 45) return { text: '優秀', color: 'text-blue-600' };
                if (count >= 35) return { text: '良好', color: 'text-blue-600' };
                if (count >= 25) return { text: '中等', color: 'text-blue-600' };
                if (count >= 15) return { text: '稍差', color: 'text-red-600' };
                return { text: '差', color: 'text-red-600' };
            } else {
                if (count >= 35) return { text: '優秀', color: 'text-blue-600' };
                if (count >= 25) return { text: '良好', color: 'text-blue-600' };
                if (count >= 15) return { text: '中等', color: 'text-blue-600' };
                if (count >= 10) return { text: '稍差', color: 'text-red-600' };
                return { text: '差', color: 'text-red-600' };
            }
        };

        const getDetailedEvaluation = (m, gender, age) => {
            if (!m || !m.data || m.data.length === 0) return null;
            const d = m.data[m.data.length - 1];
            const hm = d.height / 100;
            const bmi = (d.weight / (hm * hm)).toFixed(1);
            const sMMweight = (d.weight * d.sMM / 100).toFixed(1);
            const smi = (sMMweight / hm).toFixed(2);
            const whr = (d.waist / d.hip).toFixed(2);

            // BMI
            const bmiMax = (24 * hm * hm).toFixed(1);
            const bmiMin = (18.5 * hm * hm).toFixed(1);
            let bmiEval = { text: '正常', color: 'text-blue-600' };
            if (bmi < 18.5) bmiEval = { text: '偏低', color: 'text-red-600' };
            else if (bmi > 24) bmiEval = { text: '偏高', color: 'text-red-600' };

            const fatLimit = gender === '男' ? 20 : 30;
            const fatEval = d.bodyFat > fatLimit ? { text: '偏高', color: 'text-red-600' } : { text: '正常', color: 'text-blue-600' };

            const smmMin = gender === '男' ? 32.9 : 25.9;
            const smmEval = d.sMM < smmMin ? { text: '偏低', color: 'text-red-600' } : { text: '正常', color: 'text-blue-600' };

            // SMI
            const smiLimit = gender === '男' ? 7.0 : 5.7;
            const smiEval = smi < smiLimit ? { text: '偏低', color: 'text-red-600' } : { text: '正常', color: 'text-blue-600' };

            const vfEval = d.visceralFat > 10 ? { text: '偏高', color: 'text-red-600' } : { text: '正常', color: 'text-blue-600' };

            const whrStd = gender === '男' ? 0.92 : 0.88;
            const whrEval = whr > whrStd ? { text: '偏高', color: 'text-red-600' } : { text: '正常', color: 'text-blue-600' };

            const sitStandStd = gender === '男' ? (age <= 60 ? 18 : 24) : (age <= 60 ? 15 : 22);
            const sitStandEval = d.sitStand < sitStandStd ? { text: '偏低', color: 'text-red-600' } : { text: '正常', color: 'text-blue-600' };

            const walkPredict = gender === '男' ? 
                (2.11 * d.height - 2.29 * d.weight - 5.78 * age + 667) : 
                (7.57 * d.height - 1.76 * d.weight - 5.02 * age - 309);
            const walkMin = Math.round(gender === '男' ? walkPredict - 139 : walkPredict - 153);
            const walkEval = d.walk6m < walkMin ? { text: '偏低', color: 'text-red-600' } : { text: '正常', color: 'text-blue-600' };

            const situpsEval = getSitupsLevel(d.situps, gender, age);
            const reachStd = gender === '男' ? 10 : 15;
            let reachEval = { text: '正常', color: 'text-blue-600' };
            if (d.sitReach >= reachStd + 10) reachEval = { text: '優秀', color: 'text-blue-600' };
            else if (d.sitReach >= reachStd + 5) reachEval = { text: '良好', color: 'text-blue-600' };
            else if (d.sitReach >= reachStd - 5) reachEval = { text: '稍差', color: 'text-red-600' };
            else if (d.sitReach < reachStd) reachEval = { text: '差', color: 'text-red-600' };

            const ageDiff = d.bodyAge - age;
            const ageDiffStr = ageDiff > 0 ? `+${ageDiff}` : ageDiff.toString();
            const ageColor = ageDiff > 0 ? 'text-red-600' : 'text-blue-600';
            const ageEval = ageDiff > 0 ? { text: '老化', color: 'text-red-600' } : { text: '年輕', color: 'text-blue-600' };

            return {
                bmi, bmiMin, bmiMax, bmiEval, fatLimit, fatEval, smmMin, smmEval,
                smi, smiLimit, smiEval, vfEval, whr, whrStd, whrEval,
                sitStandStd, sitStandEval, walkMin, walkEval, situpsEval,
                reachStd, reachEval, sMMweight, ageDiffStr, ageColor, ageEval
            };
        };

        const App = () => {
            const [view, setView] = useState('dashboard');
            const [selectedUserId, setSelectedUserId] = useState('');
            const [selectedDates, setSelectedDates] = useState([]);
            const [bodyMetric, setBodyMetric] = useState('weight');
            const [performanceMetric, setPerformanceMetric] = useState('walk6m');

            const members = useState([
                {
                    id: '001',
                    bed: 'A01',
                    name: '王大明',
                    gender: '男',
                    birthday: '1985-05-20',
                    data: [
                        {
                            date: '2023-01-15',
                            weight: 82,
                            height: 175,
                            bodyFat: 28,
                            sMM: 29,
                            visceralFat: 13,
                            sitStand: 10,
                            walk6m: 320,
                            sitReach: 2,
                            situps: 5,
                            waist: 98,
                            hip: 90,
                            bmr: 1650,
                            bodyAge: 45
                        },
                        {
                            date: '2024-06-10',
                            weight: 75,
                            height: 175,
                            bodyFat: 21,
                            sMM: 33,
                            visceralFat: 9,
                            sitStand: 18,
                            walk6m: 450,
                            sitReach: 12,
                            situps: 18,
                            waist: 88,
                            hip: 90,
                            bmr: 1720,
                            bodyAge: 38
                        }
                    ]
                },
                {
                    id: '002',
                    bed: 'B03',
                    name: '李小美',
                    gender: '女',
                    birthday: '1990-11-10',
                    data: [
                        {
                            date: '2024-06-12',
                            weight: 63,
                            height: 160,
                            bodyFat: 30,
                            sMM: 25,
                            visceralFat: 7,
                            sitStand: 13,
                            walk6m: 340,
                            sitReach: 18,
                            situps: 12,
                            waist: 82,
                            hip: 95,
                            bmr: 1350,
                            bodyAge: 35
                        }
                    ]
                }
            ])[0];

            const allDates = useMemo(() => {
                const dates = new Set();
                members.forEach(m => m.data.forEach(d => dates.add(d.date)));
                return Array.from(dates).sort((a, b) => a.localeCompare(b));
            }, [members]);

            const sortedMembers = useMemo(() => [...members].sort((a, b) => a.id.localeCompare(b.id)), [members]);

            const selectedUser = useMemo(() =>
                members.find(m => m.id === selectedUserId) || members[0], [members, selectedUserId]
            );

            const evalResults = useMemo(() =>
                selectedUser ? getDetailedEvaluation(selectedUser, selectedUser.gender, calculateAge(selectedUser.birthday)) : null,
                [selectedUser]
            );

            const filteredStats = useMemo(() => {
                let targetEntries = [];
                let memberIdsInFilter = new Set();
                let ages = [];
                let maleCount = 0;
                let femaleCount = 0;

                members.forEach(m => {
                    const age = calculateAge(m.birthday);
                    let mHasDataInDate = false;
                    m.data.forEach(d => {
                        if (selectedDates.length === 0 || selectedDates.includes(d.date)) {
                            const res = getDetailedEvaluation({ data: [d] }, m.gender, age);
                            targetEntries.push({ ...d, res, gender: m.gender });
                            mHasDataInDate = true;
                        }
                    });
                    if (mHasDataInDate) {
                        memberIdsInFilter.add(m.id);
                        ages.push(age);
                        if (m.gender === '男') maleCount++;
                        else femaleCount++;
                    }
                });

                const total = targetEntries.length;
                const bmiAlert = targetEntries.filter(d => parseFloat(d.res.bmi) > 27).length;
                const vfAlert = targetEntries.filter(d => d.visceralFat > 10).length;
                const smmAlert = targetEntries.filter(d => d.sMM < 30).length;
                const smiAlert = targetEntries.filter(d => d.res.smi < d.res.smiLimit).length;
                const avgAge = ages.length === 0 ? 0 : (ages.reduce((a, b) => a + b, 0) / ages.length).toFixed(1);

                return {
                    total, bmiAlert, vfAlert, smmAlert, smiAlert,
                    maleCount, femaleCount, avgAge, memberTotal: memberIdsInFilter.size
                };
            }, [members, selectedDates]);

            const handleAddEntry = (newEntry) => {
                const existing = members.find(m => m.bed === newEntry.bed && m.name === newEntry.name);
                if (existing) {
                    const updated = members.map(m =>
                        m.id === existing.id ? { ...m, data: [...m.data, ...newEntry.data] } : m
                    );
                    setMembers(updated);
                } else {
                    const newId = String(members.length + 1).padStart(3, '0');
                    setMembers([...members, { id: newId, ...newEntry, data: [newEntry.data] }]);
                }
                alert('新增成功！');
            };

            const newEntry = useState({
                date: new Date().toISOString().split('T')[0],
                bed: '',
                name: '',
                birthday: '',
                gender: '',
                height: '',
                weight: '',
                bodyFat: '',
                sMM: '',
                bmr: '',
                bodyAge: '',
                visceralFat: '',
                waist: '',
                hip: '',
                situps: '',
                walk6m: '',
                sitStand: '',
                sitReach: ''
            })[0];

            const fields1 = [
                { l: 'BMI', v: evalResults?.bmi, s: evalResults?.bmiEval?.text, h: '18.5-24', c: evalResults?.bmiEval?.color },
                { l: '體重', v: `${selectedUser?.data[selectedUser.data.length - 1]?.weight}kg`, s: '', h: `${evalResults?.bmiMin}-${evalResults?.bmiMax}kg`, c: 'text-blue-600' },
                { l: '體脂率', v: selectedUser?.data[selectedUser.data.length - 1]?.bodyFat, s: evalResults?.fatEval?.text, h: evalResults?.fatLimit, c: evalResults?.fatEval?.color },
                { l: '骨骼肌量', v: selectedUser?.data[selectedUser.data.length - 1]?.sMM, s: evalResults?.smmEval?.text, h: evalResults?.smmMin, c: evalResults?.smmEval?.color },
                { l: '肌肉重量', v: `${evalResults?.sMMweight}kg`, s: '', h: '', c: 'text-blue-600' },
                { l: 'SMI', v: evalResults?.smi, s: evalResults?.smiEval?.text, h: evalResults?.smiLimit, c: evalResults?.smiEval?.color },
                { l: '內臟脂肪', v: selectedUser?.data[selectedUser.data.length - 1]?.visceralFat, s: evalResults?.vfEval?.text, h: '1-9', c: evalResults?.vfEval?.color },
                { l: '腰臀比', v: evalResults?.whr, s: evalResults?.whrEval?.text, h: evalResults?.whrStd, c: evalResults?.whrEval?.color },
                { l: '生理年齡', v: evalResults?.ageDiffStr, s: evalResults?.ageEval?.text, h: '', c: evalResults?.ageColor },
                { l: '基礎代謝', v: selectedUser?.data[selectedUser.data.length - 1]?.bmr, s: '', h: 'kcal', c: 'text-blue-600' }
            ];

            const fields2 = [
                { l: '仰臥起坐', v: selectedUser?.data[selectedUser.data.length - 1]?.situps, s: evalResults?.situpsEval?.text, h: '', c: evalResults?.situpsEval?.color },
                { l: '6MWD', v: `${selectedUser?.data[selectedUser.data.length - 1]?.walk6m}m`, s: evalResults?.walkEval?.text, h: `${evalResults?.walkMin}m`, c: evalResults?.walkEval?.color },
                { l: '坐站30秒', v: selectedUser?.data[selectedUser.data.length - 1]?.sitStand, s: evalResults?.sitStandEval?.text, h: evalResults?.sitStandStd, c: evalResults?.sitStandEval?.color },
                { l: '坐姿前屈', v: `${selectedUser?.data[selectedUser.data.length - 1]?.sitReach}cm`, s: evalResults?.reachEval?.text, h: '', c: evalResults?.reachEval?.color }
            ];

            const bodyChartData = useMemo(() => [
                { d: '2023-01', v: 75 },
                { d: '2023-06', v: 74 },
                { d: '2024-01', v: 72 }
            ], []);

            const perfChartData = useMemo(() => [
                { d: '2023-01', v: 320 },
                { d: '2023-06', v: 345 },
                { d: '2024-01', v: 370 }
            ], []);

            return (
                <div className="min-h-screen bg-slate-50">
                    {/* Header */}
                    <header className="flex flex-col md:flex-row justify-between items-center mb-8 bg-white p-6 rounded-2xl shadow-sm border border-slate-100 gap-4">
                        <div>
                            <h1 className="text-2xl font-bold text-indigo-900 flex items-center gap-2">
                                <Activity className="text-indigo-600" /> OT Supervisor Management Console
                            </h1>
                            <p className="text-slate-500 text-sm italic">職能治療督導管理系統</p>
                        </div>
                        <nav className="flex bg-slate-100 p-1 rounded-xl">
                            <button onClick={() => setView('dashboard')}
                                className={`px-4 py-2 rounded-lg text-sm transition ${view === 'dashboard' ? 'bg-white shadow text-indigo-600 font-bold' : 'text-slate-500'}`}>
                                儀表板
                            </button>
                            <button onClick={() => setView('individual')}
                                className={`px-4 py-2 rounded-lg text-sm transition ${view === 'individual' ? 'bg-white shadow text-indigo-600 font-bold' : 'text-slate-500'}`}>
                                個案報告
                            </button>
                            <button onClick={() => setView('entry')}
                                className={`px-4 py-2 rounded-lg text-sm transition ${view === 'entry' ? 'bg-white shadow text-indigo-600 font-bold' : 'text-slate-500'}`}>
                                資料輸入
                            </button>
                        </nav>
                    </header>

                    {view === 'dashboard' && (
                        <div className="space-y-6">
                            <div className="bg-white p-4 rounded-xl shadow-sm border flex items-center gap-4">
                                <span className="text-sm font-bold text-slate-500 flex items-center gap-1">
                                    <Calendar size={16} />
                                    <span>篩選日期</span>
                                </span>
                                <div className="flex flex-wrap gap-2">
                                    {allDates.map(date => (
                                        <button key={date} onClick={() => {
                                            setSelectedDates(prev => prev.includes(date) ? prev.filter(d => d !== date) : [...prev, date]);
                                        }}
                                            className={`px-3 py-1 rounded-full text-xs transition ${selectedDates.includes(date) ? 'bg-indigo-600 text-white' : 'bg-slate-100 text-slate-500'}`}>
                                            {date}
                                        </button>
                                    ))}
                                </div>
                            </div>

                            <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 flex items-center gap-4">
                                    <div className="bg-indigo-100 p-3 rounded-xl text-indigo-600">
                                        <Users size={24} />
                                    </div>
                                    <div>
                                        <p className="text-xs font-bold text-slate-400">總人數</p>
                                        <h3 className="text-xl font-black text-slate-700">{filteredStats.memberTotal}</h3>
                                    </div>
                                </div>
                                <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 flex items-center gap-4">
                                    <div className="bg-blue-100 p-3 rounded-xl text-blue-600">
                                        <User size={24} />
                                    </div>
                                    <div>
                                        <p className="text-xs font-bold text-slate-400">性別分布</p>
                                        <h3 className="text-xl font-black text-slate-700">{filteredStats.maleCount}男 {filteredStats.femaleCount}女</h3>
                                    </div>
                                </div>
                                <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 flex items-center gap-4">
                                    <div className="bg-emerald-100 p-3 rounded-xl text-emerald-600">
                                        <Calendar size={24} />
                                    </div>
                                    <div>
                                        <p className="text-xs font-bold text-slate-400">平均年齡</p>
                                        <h3 className="text-xl font-black text-slate-700">{filteredStats.avgAge}</h3>
                                    </div>
                                </div>
                            </div>

                            <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
                                <div className="bg-white p-6 rounded-2xl border-l-4 border-indigo-500 shadow-sm text-center">
                                    <p className="text-slate-500 text-xs font-bold">BMI ≥ 27</p>
                                    <h3 className="text-2xl font-black mt-1 text-indigo-900">{filteredStats.bmiAlert}/{filteredStats.total}</h3>
                                </div>
                                <div className="bg-white p-6 rounded-2xl border-l-4 border-red-500 shadow-sm text-center">
                                    <p className="text-slate-500 text-xs font-bold">VF ≥ 10</p>
                                    <h3 className="text-2xl font-black mt-1 text-red-600">{filteredStats.vfAlert}/{filteredStats.total}</h3>
                                </div>
                                <div className="bg-white p-6 rounded-2xl border-l-4 border-amber-500 shadow-sm text-center">
                                    <p className="text-slate-500 text-xs font-bold">SMM &lt; 30</p>
                                    <h3 className="text-2xl font-black mt-1 text-amber-600">{filteredStats.smmAlert}/{filteredStats.total}</h3>
                                </div>
                                <div className="bg-white p-6 rounded-2xl border-l-4 border-rose-500 shadow-sm text-center">
                                    <p className="text-slate-500 text-xs font-bold">SMI 異常</p>
                                    <h3 className="text-2xl font-black mt-1 text-rose-600">{filteredStats.smiAlert}/{filteredStats.total}</h3>
                                </div>
                            </div>

                            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <div className="bg-white p-6 rounded-2xl shadow-sm border">
                                    <h3 className="font-bold text-slate-700 flex items-center gap-2 mb-6">
                                        <Database size={18} />
                                        身體組成趨勢
                                    </h3>
                                    <select value={bodyMetric} onChange={e => setBodyMetric(e.target.value)}
                                        className="mb-4 w-full p-2 bg-slate-50 rounded-lg text-sm border-none focus:ring-2 ring-indigo-500">
                                        <option value="weight">體重 (kg)</option>
                                        <option value="bodyFat">體脂率</option>
                                        <option value="sMM">骨骼肌量</option>
                                        <option value="visceralFat">內臟脂肪</option>
                                        <option value="bmi">BMI</option>
                                    </select>
                                    <div className="h-64">
                                        <ResponsiveContainer width="100%" height="100%">
                                            <LineChart data={bodyChartData}>
                                                <CartesianGrid strokeDasharray="3 3" vertical={false} />
                                                <XAxis dataKey="d" />
                                                <YAxis />
                                                <Tooltip />
                                                <Line type="monotone" dataKey="v" name="數值" stroke="#6366f1" strokeWidth={3} />
                                            </LineChart>
                                        </ResponsiveContainer>
                                    </div>
                                </div>
                                <div className="bg-white p-6 rounded-2xl shadow-sm border">
                                    <h3 className="font-bold text-slate-700 flex items-center gap-2 mb-6">
                                        <Activity size={18} />
                                        功能表現趨勢
                                    </h3>
                                    <select value={performanceMetric} onChange={e => setPerformanceMetric(e.target.value)}
                                        className="mb-4 w-full p-2 bg-slate-50 rounded-lg text-sm border-none focus:ring-2 ring-emerald-500">
                                        <option value="walk6m">6分鐘步行</option>
                                        <option value="situps">仰臥起坐</option>
                                        <option value="sitReach">坐姿前屈</option>
                                        <option value="sitStand30">坐站30秒</option>
                                    </select>
                                    <div className="h-64">
                                        <ResponsiveContainer width="100%" height="100%">
                                            <LineChart data={perfChartData}>
                                                <CartesianGrid strokeDasharray="3 3" vertical={false} />
                                                <XAxis dataKey="d" />
                                                <YAxis />
                                                <Tooltip />
                                                <Line type="monotone" dataKey="v" name="數值" stroke="#10b981" strokeWidth={3} />
                                            </LineChart>
                                        </ResponsiveContainer>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {view === 'individual' && selectedUser && (
                        <div className="space-y-6">
                            <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 flex items-center gap-4">
                                <span className="text-slate-500 font-bold text-sm">選擇個案</span>
                                <select value={selectedUserId} onChange={e => setSelectedUserId(e.target.value)}
                                    className="flex-1 p-2 bg-slate-50 border-slate-200 rounded-xl focus:ring-2 ring-indigo-500">
                                    <option value="">-- 請選擇 --</option>
                                    {sortedMembers.map(m => (
                                        <option key={m.id} value={m.id}>{m.id} - {m.name} ({m.bed})</option>
                                    ))}
                                </select>
                            </div>

                            {selectedUser && evalResults && (
                                <div id="report-content" className="space-y-8">
                                    <div className="bg-white p-8 rounded-3xl shadow-sm border border-slate-100 min-h-[1050px]">
                                        <div className="flex justify-between items-start mb-6">
                                            <div>
                                                <h2 className="text-3xl font-bold text-slate-800">
                                                    {selectedUser.name}
                                                    <span className="text-lg font-normal text-slate-400 ml-4">
                                                        {calculateAge(selectedUser.birthday)}歲 {selectedUser.gender}
                                                        ({selectedUser.data[selectedUser.data.length - 1]?.date})
                                                    </span>
                                                </h2>
                                            </div>
                                            <button onClick={() => window.print()}
                                                className="bg-indigo-600 text-white px-4 py-2 rounded-xl text-sm flex items-center gap-2">
                                                <Download size={16} />
                                                PDF 列印
                                            </button>
                                        </div>

                                        <div className="mb-8">
                                            <h4 className="font-bold text-sm text-indigo-600 mb-4 flex items-center gap-2 border-b pb-2">
                                                <User size={16} /> 1. 身體組成評估
                                            </h4>
                                            <div className="grid grid-cols-5 gap-3">
                                                {fields1.map((item, i) => (
                                                    <div key={i} className="p-3 rounded-xl border bg-slate-50 border-slate-100 relative flex flex-col justify-between h-24">
                                                        <div>
                                                            <p className="text-[10px] font-bold text-slate-400 uppercase leading-none mb-1">{item.l}</p>
                                                            <p className={`text-xl font-black text-indigo-900 leading-tight ${item.c}`}>{item.v}</p>
                                                        </div>
                                                        <div className="flex justify-between items-baseline mt-auto border-t border-slate-200 pt-1">
                                                            <span className="text-xl font-black">{item.c}{item.s}</span>
                                                            <span className="text-[9px] text-slate-400 font-bold text-right">{item.h}</span>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>

                                        <div className="grid grid-cols-2 gap-8 items-start">
                                            <div className="space-y-4">
                                                <h4 className="font-bold text-sm text-slate-600 flex items-center gap-2">
                                                    <PieChart size={16} /> PR 雷達圖
                                                </h4>
                                                <div className="h-80 bg-slate-50 rounded-2xl border border-slate-100 flex flex-col items-center justify-center p-4">
                                                    <ResponsiveContainer width="100%" height="80%">
                                                        <RadarChart data={[
                                                            { subject: 'BMI', v: 80 },
                                                            { subject: '體脂', v: 70 },
                                                            { subject: 'SMM', v: 60 },
                                                            { subject: 'SMI', v: 90 },
                                                            { subject: 'VF', v: 50 },
                                                            { subject: 'WHR', v: 40 }
                                                        ]}>
                                                            <PolarGrid />
                                                            <PolarAngleAxis dataKey="subject" />
                                                            <PolarRadiusAxis />
                                                            <Radar name="PR" dataKey="v" stroke="#6366f1" fill="#6366f1" fillOpacity={0.5} />
                                                        </RadarChart>
                                                    </ResponsiveContainer>
                                                </div>
                                                <div className="text-[11px] text-indigo-700 font-bold mt-2 text-center bg-indigo-50 p-2 rounded-lg border border-indigo-100 leading-relaxed">
                                                    PR <span className="text-lg">65</span><br />
                                                    <span className="text-[9px] text-slate-500 font-normal">PR 0-100</span>
                                                </div>
                                            </div>

                                            <div className="space-y-4">
                                                <h4 className="font-bold text-sm text-emerald-600 flex items-center gap-2">
                                                    <Activity size={16} /> 2. 功能表現
                                                </h4>
                                                <div className="space-y-4">
                                                    {fields2.map((item, i) => (
                                                        <div key={i} className="flex justify-between items-center bg-white p-4 rounded-xl border-l-4 border-emerald-500 shadow-sm border border-slate-100 h-24">
                                                            <div className="flex flex-col justify-center">
                                                                <p className="text-xs text-slate-400 font-bold">{item.l}</p>
                                                                <p className={`text-xl font-black text-slate-700 leading-tight ${item.c}`}>{item.v}</p>
                                                            </div>
                                                            <div className="flex flex-col items-end justify-between h-full py-1">
                                                                <p className="text-xl font-black">{item.c}{item.s}</p>
                                                                <p className="text-[10px] text-slate-400 font-bold">{item.h}</p>
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        </div>

                                        {/* Page 2 */}
                                        <div className="bg-white p-8 rounded-3xl shadow-sm border border-slate-100 break-before-page">
                                            <h3 className="text-xl font-bold mb-8 text-slate-700 italic border-l-4 border-indigo-500 pl-4">Page 2</h3>
                                            <div className="grid grid-cols-2 gap-6 mb-8">
                                                <div className="h-52 bg-slate-50 p-4 rounded-2xl border">
                                                    <p className="text-xs font-bold text-slate-500 mb-2">1.</p>
                                                    <ResponsiveContainer width="100%" height="100%">
                                                        <LineChart data={selectedUser.data}>
                                                            <CartesianGrid strokeDasharray="3 3" vertical={false} />
                                                            <XAxis dataKey="date" hide />
                                                            <YAxis />
                                                            <Tooltip />
                                                            <Line type="monotone" dataKey="bodyFat" name="體脂率" stroke="#f43f5e" strokeWidth={3} />
                                                            <Line type="monotone" dataKey="sMM" name="骨骼肌量" stroke="#10b981" strokeWidth={3} />
                                                            <Legend iconType="circle" />
                                                        </LineChart>
                                                    </ResponsiveContainer>
                                                </div>
                                                <div className="h-52 bg-slate-50 p-4 rounded-2xl border">
                                                    <p className="text-xs font-bold text-slate-500 mb-2">2. 6MWD</p>
                                                    <ResponsiveContainer width="100%" height="100%">
                                                        <LineChart data={selectedUser.data}>
                                                            <CartesianGrid strokeDasharray="3 3" vertical={false} />
                                                            <XAxis dataKey="date" hide />
                                                            <YAxis />
                                                            <Tooltip />
                                                            <Line type="monotone" dataKey="walk6m" name="6分鐘步行距離" stroke="#6366f1" strokeWidth={3} />
                                                        </LineChart>
                                                    </ResponsiveContainer>
                                                </div>
                                                <div className="h-52 bg-slate-50 p-4 rounded-2xl border">
                                                    <p className="text-xs font-bold text-slate-500 mb-2">3. 坐站30秒</p>
                                                    <ResponsiveContainer width="100%" height="100%">
                                                        <LineChart data={selectedUser.data}>
                                                            <CartesianGrid strokeDasharray="3 3" vertical={false} />
                                                            <XAxis dataKey="date" hide />
                                                            <YAxis />
                                                            <Tooltip />
                                                            <Line type="monotone" dataKey="sitStand" name="坐站30秒次數" stroke="#f59e0b" strokeWidth={3} />
                                                        </LineChart>
                                                    </ResponsiveContainer>
                                                </div>
                                                <div className="h-52 bg-slate-50 p-4 rounded-2xl border">
                                                    <p className="text-xs font-bold text-slate-500 mb-2">4. 仰臥起坐</p>
                                                    <ResponsiveContainer width="100%" height="100%">
                                                        <LineChart data={selectedUser.data}>
                                                            <CartesianGrid strokeDasharray="3 3" vertical={false} />
                                                            <XAxis dataKey="date" hide />
                                                            <YAxis />
                                                            <Tooltip />
                                                            <Line type="monotone" dataKey="situps" name="仰臥起坐次數" stroke="#8b5cf6" strokeWidth={3} />
                                                        </LineChart>
                                                    </ResponsiveContainer>
                                                </div>
                                            </div>

                                            <div className="grid grid-cols-2 gap-6">
                                                <div className="bg-indigo-50 p-6 rounded-2xl border border-indigo-100">
                                                    <h4 className="font-bold text-indigo-700 flex items-center gap-2 mb-4">
                                                        <Heart size={18} /> OT 介入建議
                                                    </h4>
                                                    <ul className="text-sm text-slate-600 space-y-2 list-disc pl-4 leading-relaxed">
                                                        <li><strong>減重訓練</strong> 3次/週</li>
                                                        <li><strong>有氧運動</strong> 150分鐘/週</li>
                                                        <li><strong>肌力訓練</strong></li>
                                                    </ul>
                                                </div>
                                                <div className="bg-emerald-50 p-6 rounded-2xl border border-emerald-100">
                                                    <h4 className="font-bold text-emerald-700 flex items-center gap-2 mb-4">
                                                        <Coffee size={18} /> 生活指導
                                                    </h4>
                                                    <ul className="text-sm text-slate-600 space-y-2 list-disc pl-4 leading-relaxed">
                                                        <li><strong>規律飲食</strong></li>
                                                        <li><strong>充足睡眠</strong></li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>
                    )}

                    {view === 'entry' && (
                        <div className="max-w-4xl mx-auto space-y-6">
                            <div className="bg-indigo-600 text-white p-6 rounded-2xl shadow-lg flex justify-between items-center">
                                <div>
                                    <h3 className="text-xl font-bold flex items-center gap-2">
                                        <PlusCircle />
                                        新增資料
                                    </h3>
                                </div>
                                <div className="text-right">
                                    <label className="block text-[10px] uppercase font-bold opacity-70">日期</label>
                                    <input type="date" value={newEntry.date} onChange={e => setNewEntry({ ...newEntry, date: e.target.value })}
                                        className="bg-indigo-500 border-none rounded p-1 text-sm text-white" />
                                </div>
                            </div>

                            <div className="bg-white p-8 rounded-2xl shadow-sm border border-slate-100">
                                <h4 className="font-bold text-slate-700 mb-6 flex items-center gap-2 border-b pb-2">
                                    <Info size={18} /> 1. 基本資料
                                </h4>
                                <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
                                    <div className="space-y-1">
                                        <label className="text-xs font-bold text-slate-500">床號</label>
                                        <input type="text" value={newEntry.bed} onChange={e => setNewEntry({ ...newEntry, bed: e.target.value })}
                                            className="w-full p-2 border rounded-lg bg-slate-50" />
                                    </div>
                                    <div className="space-y-1">
                                        <label className="text-xs font-bold text-slate-500">姓名</label>
                                        <input type="text" value={newEntry.name} onChange={e => setNewEntry({ ...newEntry, name: e.target.value })}
                                            className="w-full p-2 border rounded-lg bg-slate-50" />
                                    </div>
                                    <div className="space-y-1">
                                        <label className="text-xs font-bold text-slate-500">生日</label>
                                        <input type="date" value={newEntry.birthday} onChange={e => setNewEntry({ ...newEntry, birthday: e.target.value })}
                                            className="w-full p-2 border rounded-lg bg-slate-50" />
                                    </div>
                                    <div className="space-y-1">
                                        <label className="text-xs font-bold text-slate-500">性別</label>
                                        <select value={newEntry.gender} onChange={e => setNewEntry({ ...newEntry, gender: e.target.value })}
                                            className="w-full p-2 border rounded-lg bg-slate-50">
                                            <option value="">請選擇</option>
                                            <option value="男">男</option>
                                            <option value="女">女</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div className="bg-white p-8 rounded-2xl shadow-sm border border-slate-100">
                                <h4 className="font-bold text-slate-700 mb-6 flex items-center gap-2 border-b pb-2">
                                    <Database size={18} /> 2. 身體組成 Key-in
                                </h4>
                                <div className="grid grid-cols-2 md:grid-cols-4 gap-6">
                                    {[
                                        { l: '身高 cm', k: 'height' },
                                        { l: '體重 kg', k: 'weight' },
                                        { l: '體脂率 %', k: 'bodyFat' },
                                        { l: '骨骼肌量 %', k: 'sMM' },
                                        { l: '基礎代謝 kcal', k: 'bmr' },
                                        { l: '生理年齡', k: 'bodyAge' },
                                        { l: '內臟脂肪', k: 'visceralFat' },
                                        { l: '腰圍 cm', k: 'waist' },
                                        { l: '臀圍 cm', k: 'hip' }
                                    ].map(f => (
                                        <div key={f.k} className="space-y-1">
                                            <label className="text-xs font-bold text-slate-500">{f.l}</label>
                                            <input type="number" step="0.1" value={newEntry[f.k]} onChange={e => setNewEntry({ ...newEntry, [f.k]: e.target.value })}
                                                className="w-full p-2 border rounded-lg bg-slate-50" />
                                        </div>
                                    ))}
                                    <div className="space-y-1">
                                        <label className="text-xs font-bold text-slate-500">WHR</label>
                                        <input disabled value={newEntry.waist && newEntry.hip ? (newEntry.waist / newEntry.hip).toFixed(2) : ''}
                                            className="w-full p-2 border rounded-lg bg-slate-200 cursor-not-allowed" />
                                    </div>
                                </div>
                            </div>

                            <div className="bg-white p-8 rounded-2xl shadow-sm border border-slate-100">
                                <h4 className="font-bold text-slate-700 mb-6 flex items-center gap-2 border-b pb-2">
                                    <Activity size={18} /> 3. 功能測驗 Key-in
                                </h4>
                                <div className="grid grid-cols-2 gap-6">
                                    <div className="space-y-1">
                                        <label className="text-xs font-bold text-slate-500">仰臥起坐</label>
                                        <input type="number" value={newEntry.situps} onChange={e => setNewEntry({ ...newEntry, situps: e.target.value })}
                                            className="w-full p-2 border rounded-lg bg-slate-50" />
                                    </div>
                                    <div className="space-y-1">
                                        <label className="text-xs font-bold text-slate-500">6MWD m</label>
                                        <input type="number" value={newEntry.walk6m} onChange={e => setNewEntry({ ...newEntry, walk6m: e.target.value })}
                                            className="w-full p-2 border rounded-lg bg-slate-50" />
                                    </div>
                                    <div className="space-y-1">
                                        <label className="text-xs font-bold text-slate-500">坐站30秒</label>
                                        <input type="number" value={newEntry.sitStand} onChange={e => setNewEntry({ ...newEntry, sitStand: e.target.value })}
                                            className="w-full p-2 border rounded-lg bg-slate-50" />
                                    </div>
                                    <div className="space-y-1">
                                        <label className="text-xs font-bold text-slate-500">坐姿前屈 cm</label>
                                        <input type="number" value={newEntry.sitReach} onChange={e => setNewEntry({ ...newEntry, sitReach: e.target.value })}
                                            className="w-full p-2 border rounded-lg bg-slate-50" />
                                    </div>
                                </div>
                            </div>

                            <button onClick={() => handleAddEntry(newEntry)}
                                className="w-full bg-indigo-600 text-white p-4 rounded-2xl font-bold shadow-lg hover:bg-indigo-700 transition transform active:scale-95">
                                儲存並新增到資料庫
                            </button>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
